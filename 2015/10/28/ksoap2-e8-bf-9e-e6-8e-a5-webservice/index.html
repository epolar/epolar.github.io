<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Eraise"><meta name="description" content="ksoap2连接webservice，ksoap2较为轻型，适合Android使用，Android没有内置WebService工具，WebService传回数据是标准的XML，可以用SoapObject直接得到结点值ksoap2code.google.com地址：http"><meta name="keywords" content="KSoap,webservice"><title>ksoap2 连接 webservice · 我吃西瓜</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://eraise.xyz/2015/10/28/ksoap2-e8-bf-9e-e6-8e-a5-webservice/"><link rel="alternate" href="/atom.xml" title="我吃西瓜"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?92ceb44df626dd88b7190057da6f94e0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="/." class="logo">我吃西瓜</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">主页</a></li><li class="nav-link"><a href="/archives" target="_self">文章</a></li><li class="nav-link"><a href="/categories" target="_self">分类</a></li><li class="nav-link"><a href="/tags" target="_self">标签</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">ksoap2 连接 webservice</h1><span class="post-time">2015年10月28日</span><div class="post-content"><p>ksoap2 连接 webservice，ksoap2 较为轻型，适合Android使用，Android没有内置WebService工具，WebService传回数据是标准的XML，可以用SoapObject直接得到结点值<br>ksoap2 code.google.com地址：<a href="https://code.google.com/p/ksoap2-android/" target="_blank" rel="external">https://code.google.com/p/ksoap2-android/</a><br>下载的ksoap2-android-assembly-x.x.x-jar-with-dependencies.jar文件放到libs中就可以使用了。</p>
<p>ksoap2主要使用对象： <code>SoapObject</code>(连接参数描述)、 <code>SoapSerializationEnvelope</code>(连接描述)、<code>HttpTransportSE</code>(发起连接)、<code>SoapFault/SoapFault12</code>(错误描述，可以打印错误栈)</p>
<a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME_SPACE = “http:<span class="comment">//WebXml.com.cn/”;</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL = “http:<span class="comment">//www.webxml.com.cn/WebServices/ChinaZipSearchWebService.asmx”;</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_NAME = “getSupportProvince”;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SOAP_ACTION = NAME_SPACE + METHOD_NAME;   <span class="comment">// 通常为NAME_SPACE + METHOD_NAME，为null会连接不上</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">conn</span><span class="params">()</span> </span>&#123;</div><div class="line">     <span class="comment">/* 生成SoapObject对象，指明要连接的对象</span></div><div class="line">     * 第一个参数为命名空间，第二个参数为方法 */</div><div class="line">          SoapObject so = <span class="keyword">new</span> SoapObject(NAME_SPACE, METHOD_NAME);</div><div class="line">     <span class="comment">/* 方法携带的参数 */</span></div><div class="line">     <span class="comment">// so.addProperty(“tns:getWeatherbyCityNameSoapIn”, “福建”);</span></div><div class="line">     <span class="comment">/* SOAP信息描述，传入的参数是WebService soap版本 */</span></div><div class="line">     SoapSerializationEnvelope sse = <span class="keyword">new</span> SoapSerializationEnvelope(SoapSerializationEnvelope.VER11);</div><div class="line">     <span class="comment">/* 设置输入接收对象 */</span></div><div class="line">     sse.bodyOut = so;</div><div class="line">     sse.setOutputSoapObject(so);</div><div class="line">     sse.dotNet = <span class="keyword">true</span>;     <span class="comment">// 这行功能未知，注释掉同样可以取得连接，wsdl的必须为true</span></div><div class="line">     <span class="comment">/* 创建HttpTransportSE，这个对象描述了WebService的URL，由它来进行连接 */</span></div><div class="line">     HttpTransportSE ht = <span class="keyword">new</span> HttpTransportSE(URL);</div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">          <span class="comment">/* 开始连接 */</span></div><div class="line">          ht.call(SOAP_ACTION, sse);</div><div class="line">          <span class="comment">/* 获取连接结果，造成错误经常是代码里的问题，如果测试通过应该不管是否成功都返回SoapObject */</span></div><div class="line">          <span class="keyword">if</span> (sse.bodyIn <span class="keyword">instanceof</span> SoapObject) &#123;</div><div class="line">               SoapObject rso = (SoapObject) sse.bodyIn;</div><div class="line">               SoapObject result = (SoapObject) rso.getProperty(METHOD_NAME + “Result”);</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.getPropertyCount(); i ++) &#123;</div><div class="line">                    System.out.println(result.getProperty(i));</div><div class="line">                    tv.append(result.getProperty(i).toString() + “\n”);</div><div class="line">               &#125;</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">          SoapFault sf = (SoapFault) sse.getResponse();</div><div class="line">         sf.printStackTrace();</div><div class="line">          &#125;</div><div class="line">     &#125; <span class="keyword">catch</span> (HttpResponseException e) &#123;</div><div class="line">          <span class="comment">// TODO Auto-generated catch block</span></div><div class="line">          e.printStackTrace();</div><div class="line">     &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">          <span class="comment">// TODO Auto-generated catch block</span></div><div class="line">          e.printStackTrace();</div><div class="line">     &#125; <span class="keyword">catch</span> (XmlPullParserException e) &#123;</div><div class="line">          <span class="comment">// TODO Auto-generated catch block</span></div><div class="line">          e.printStackTrace();</div><div class="line">     &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article><div class="tags"><a href="/tags/KSoap/">KSoap</a><a href="/tags/webservice/">webservice</a></div><div class="paginator"><a href="/2015/10/28/e5-8f-aa-e5-9c-a8-e4-b8-bb-e7-95-8c-e9-9d-a2-e5-ba-94-e7-94-a8-e4-b8-8a-e6-98-be-e7-a4-ba-e7-9a-84-e6-82-ac-e6-b5-ae-e7-aa-97/" class="prev"><i class="iconfont icon-left"></i><span> 上一页</span></a><a href="/2015/10/27/notificationmanager-e5-92-8cnotification/" class="next"><span>下一页</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div data-thread-key="http://eraise.xyz/2015/10/28/ksoap2-e8-bf-9e-e6-8e-a5-webservice/index.html" data-title="ksoap2 连接 webservice" data-url="http://eraise.xyz/2015/10/28/ksoap2-e8-bf-9e-e6-8e-a5-webservice/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "eraise" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section></section><footer><div class="social"><a href="mailto:eraise@qq.com" title="email" class="iconfont icon-email"></a><a href="https://github.com/epolar" title="github" class="iconfont icon-github"></a><a href="/atom.xml" title="rss" class="iconfont icon-rss"></a></div><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Eraise</span></p></div><div id="back2top"><i class="iconfont icon-up"></i></div></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>